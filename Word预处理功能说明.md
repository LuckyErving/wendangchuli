# Word文档预处理功能说明

## 🎉 新功能 (v1.2.1)

### 📝 自动预处理Word文档

程序现在会在开始处理前，自动将所有`.doc`和`.docx`文件转换为`.pdf`并保存到同一目录！

**注意**：由于`.doc`是旧格式，python-docx无法直接读取，程序会提示用户手动转换。`.docx`文件可以自动转换。

## ✨ 功能特点

### 🔄 工作流程

```
选择文件夹
    ↓
预处理（新增！）
    ├── 扫描所有.doc和.docx文件
    ├── .docx文件：使用python-docx读取内容
    ├── .doc文件：提示用户手动转换（python-docx不支持）
    ├── 使用reportlab生成PDF（仅.docx）
    └── 保存为同名.pdf文件
    ↓
正常处理流程
    ├── 扫描所有文件（包括新生成的PDF）
    ├── 识别文档类型
    ├── 转换格式
    └── 合并PDF
```

### ✅ 优点

1. **无需外部依赖**
   - ✅ 不需要Microsoft Word
   - ✅ 不需要LibreOffice
   - ✅ 使用纯Python库
   - ✅ 跨平台完全兼容

2. **智能跳过**
   - 如果PDF已存在，自动跳过
   - 避免重复转换
   - 节省时间

3. **保留原文件**
   - 原始.docx文件不受影响
   - 生成的PDF保存在同一目录
   - 文件名保持一致

4. **详细日志**
   - 显示转换进度
   - 显示成功/失败状态
   - 便于排查问题

## 📋 使用示例

### 文件夹结构（转换前）

```
630222203210020071(李时海)/
├── 申请书.pdf
├── 户主声明书.docx          ← Word文档（新格式）
├── 承包方调查表.doc          ← Word文档（旧格式）
├── 承诺书-发证签订.docx      ← Word文档（新格式）
└── ...其他文件
```

### 预处理后

```
630222203210020071(李时海)/
├── 申请书.pdf
├── 户主声明书.docx
├── 户主声明书.pdf            ← 新生成！（从.docx）
├── 承包方调查表.doc          ⚠️ 需要手动转换
├── 承诺书-发证签订.docx
├── 承诺书-发证签订.pdf        ← 新生成！（从.docx）
└── ...其他文件
```

### 最终处理

程序会自动使用新生成的PDF文件：
- `户主声明书.pdf`
- `承诺书-发证签订.pdf`

原始的`.docx`文件会被忽略（因为PDF优先级更高）。

## 🔧 技术实现

### 使用的库

1. **python-docx**
   - 读取Word文档内容
   - 提取段落文本
   - 获取格式信息

2. **reportlab**
   - 生成PDF文件
   - 设置页面大小（A4）
   - 写入文本内容

### 转换逻辑

```python
def preprocess_docx_files(folder_path):
    1. 扫描文件夹中的所有.docx文件
    2. 对每个.docx文件：
       - 检查对应的.pdf是否已存在
       - 如果存在，跳过
       - 如果不存在：
         a. 用python-docx读取内容
         b. 用reportlab创建PDF
         c. 写入文档标题和段落
         d. 保存为同名.pdf
    3. 返回已转换的PDF列表
```

## ⚠️ 注意事项

### 文件格式支持

| 格式 | 支持 | 说明 |
|------|------|------|
| .docx | ✅ 自动转换 | 使用python-docx读取 |
| .doc | ⚠️ 需要手动 | python-docx不支持旧格式 |

#### .doc文件处理方案

如果文件夹中有`.doc`文件，程序会显示警告：
```
⚠️ .doc格式需要LibreOffice或Word转换，已跳过
提示: 请手动在Word中打开并另存为.docx或.pdf
```

**手动转换步骤**：
1. 在Word中打开`.doc`文件
2. 文件 → 另存为
3. 选择格式：`.docx`（推荐）或`.pdf`
4. 保存到同一文件夹
5. 重新运行程序

### 转换限制

由于使用纯Python实现，转换的PDF是**简化版本**：

**保留的内容**：
- ✅ 文本内容
- ✅ 段落结构
- ✅ 基本格式

**不保留的内容**：
- ❌ 复杂的格式（粗体、斜体、字体大小）
- ❌ 图片
- ❌ 表格样式
- ❌ 页眉页脚
- ❌ 批注和修订

### 适用场景

**✅ 适合**：
- 纯文本或简单格式的Word文档
- 只需要保留内容的场景
- 无法安装Office或LibreOffice的环境

**❌ 不适合**：
- 复杂格式的Word文档
- 包含大量图片和表格
- 需要完全保留原格式

### 更好的替代方案

如果需要高质量的转换：

#### Windows系统
安装Microsoft Word，程序会使用`docx2pdf`进行高质量转换

#### macOS/Linux系统
安装LibreOffice，程序会使用`soffice`进行高质量转换

```bash
# macOS
brew install --cask libreoffice

# Linux
sudo apt-get install libreoffice
```

## 🎯 对比表格

| 方式 | 质量 | 依赖 | 跨平台 | 速度 |
|-----|------|------|--------|------|
| **预处理（新）** | ⭐⭐⭐ | 无 | ✅ | ⚡⚡⚡ |
| Word (Windows) | ⭐⭐⭐⭐⭐ | MS Word | ❌ | ⚡⚡ |
| LibreOffice | ⭐⭐⭐⭐ | LibreOffice | ✅ | ⚡ |

## 📊 处理流程对比

### 之前（v1.1.0）

```
选择文件夹
    ↓
扫描文件
    ↓
发现.docx文件
    ↓
尝试转换
    ├── Windows: 调用Word
    └── macOS: 调用LibreOffice
    ↓
如果失败：跳过该文件 ❌
```

### 现在（v1.2.0）

```
选择文件夹
    ↓
预处理Word文档 ✨
    ├── 转换.docx为.pdf
    └── 保存到同目录
    ↓
扫描文件
    ↓
发现.pdf文件（包括新生成的）
    ↓
直接使用 ✅
```

## 🚀 性能优化

### 智能缓存

- 已转换的PDF不会重复处理
- 减少不必要的转换
- 提高处理速度

### 进度显示

- 预处理进度：0-20%
- 扫描文件：20-40%
- 转换格式：40-85%
- 合并PDF：85-100%

## 💡 使用建议

### 首次使用

1. 运行程序
2. 选择包含Word文档的文件夹
3. 等待预处理完成（自动）
4. 继续正常流程

### 重复使用

如果PDF已生成：
- 下次处理会自动跳过转换
- 直接使用已有的PDF
- 节省时间

### 手动优化

如果对转换质量不满意：
1. 在Word/LibreOffice中手动打开.docx
2. 另存为高质量PDF
3. 删除自动生成的简化PDF
4. 重新运行程序

## 🐛 故障排除

### 问题1：转换后的PDF内容不完整

**原因**：中文字符或特殊格式无法处理

**解决**：
- 手动在Word中转换为PDF
- 或安装LibreOffice使用高质量转换

### 问题2：转换速度慢

**原因**：Word文档内容很多

**解决**：
- 正常现象，耐心等待
- 下次运行会直接使用已转换的PDF

### 问题3：PDF显示乱码

**原因**：字体问题

**解决**：
- 使用Word或LibreOffice手动转换
- 确保系统安装了必要的中文字体

## 📝 更新日志

### v1.2.1 (2025-10-19)
- ✅ 扩展支持.doc和.docx文件扫描
- ✅ .docx文件自动转换为PDF
- ⚠️ .doc文件给出提示（需要手动转换）
- ✅ 优化变量命名和代码结构

### v1.2.0 (2025-10-19)
- ✅ 新增Word文档预处理功能
- ✅ 使用python-docx + reportlab实现纯Python转换
- ✅ 智能跳过已转换的PDF
- ✅ 详细的转换日志
- ✅ 更新进度显示逻辑
- ✅ 无需外部依赖即可转换Word文档

---

**开发者**: LuckyErving  
**更新日期**: 2025-10-19  
**适用版本**: v1.2.1+
