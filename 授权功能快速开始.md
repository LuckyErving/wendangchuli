# 设备授权功能 - 快速开始

## 🎯 功能说明

文档处理器现已集成设备授权系统：
- ✅ 每台设备限制使用 **200次**
- ✅ 基于MAC地址绑定设备
- ✅ 达到上限后显示"程序已损坏"

## 🚀 快速测试

### 1. 测试授权状态
```bash
python3 test_license.py
```

### 2. 模拟使用
```bash
# 模拟使用10次
python3 test_license.py --simulate 10
```

### 3. 重置授权（开发用）
```bash
python3 test_license.py --reset
```

## 📦 打包流程

### 步骤1: 打包前清理
```bash
# macOS/Linux
./clean_before_build.sh

# Windows
clean_before_build.bat
```

**重要**: 这会删除开发时产生的授权记录，确保用户首次使用时才开始计数！

### 步骤2: 打包程序
```bash
# macOS
./build_exe_mac.sh

# Windows
build_exe.bat
```

### 步骤3: 测试打包后的程序
1. 运行打包后的exe
2. 检查界面显示"剩余199次"
3. 多次运行验证计数正确
4. 检查配置文件位置

## 📍 配置文件位置

授权记录保存在：
- **Windows**: `%APPDATA%\.docproc\.lic`
- **macOS**: `~/.docproc/.lic`
- **Linux**: `~/.docproc/.lic`

## 🧪 测试检查清单

- [ ] 首次运行显示"剩余199次"
- [ ] 运行后次数正确递减
- [ ] 重启程序次数累计正确
- [ ] 配置文件已创建在正确位置
- [ ] 配置文件已加密（无法直接读取）
- [ ] Windows下配置文件为隐藏属性
- [ ] 达到200次后显示错误并退出
- [ ] 剩余≤20次时显示警告

## ⚠️ 注意事项

1. **打包前必须清理**: 运行 `clean_before_build` 脚本
2. **不要打包测试工具**: `test_license.py` 仅供开发使用
3. **配置不在程序目录**: 配置文件在用户主目录
4. **设备绑定后无法迁移**: 首次运行的设备会被绑定

## 🔍 常见问题

**Q: 如何查看剩余次数？**
```bash
python3 test_license.py
```

**Q: 如何重置次数（测试用）？**
```bash
python3 test_license.py --reset
```

**Q: 打包后配置文件在哪？**
- 在用户主目录的 `.docproc` 隐藏文件夹中
- 不在exe所在目录

**Q: 如何验证加密是否生效？**
```bash
# macOS
cat ~/.docproc/.lic

# Windows
type %APPDATA%\.docproc\.lic
```
应该看到乱码（Base64编码的内容）

## 📋 发布清单

打包发布前确认：
- [ ] 运行了清理脚本
- [ ] 删除了 `test_license.py`（不发布给用户）
- [ ] 删除了 `clean_before_build.*` 脚本
- [ ] 删除了授权说明文档（可选，看是否公开）
- [ ] 在干净环境测试了exe
- [ ] 验证了首次使用从200次开始计数

## 💡 提示

- 开发时可以随时用 `--reset` 重置次数
- 测试时可以用 `--simulate` 快速消耗次数
- 界面会实时显示剩余次数
- 配置文件损坏时会自动重建（重新计数）

---

**准备好了吗？开始打包吧！** 🎉
